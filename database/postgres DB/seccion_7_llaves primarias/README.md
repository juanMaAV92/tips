# Llaves primarias

## Serial VS Identity


```sql
CREATE TABLE "users"(
    "user_id" SERIAL PRIMARY KEY,
    "username" VARCHAR(50) NOT NULL
)
```
> Nota: hay que tener en cuenta que esta creando una secuencia y un valor por defecto. Si por alguna razon se inserta un serial futuro, la secuencia al llegar a ese valor generarÃ¡ un error.


```sql
CREATE TABLE "users2"(
    "user_id" INTEGER GENERATED by DEFAULT as IDENTITY PRIMARY KEY,
    "username" VARCHAR(50) NOT NULL
)
```
> Nota: Tiene la misma funcionalidad que el serial y se generan error de secuencia si se inserta un valor futuro.

```sql
CREATE TABLE "users3"(
    "user_id" INTEGER GENERATED ALWAYS as IDENTITY PRIMARY KEY,
    "username" VARCHAR(50) NOT NULL
)
```
> Nota: En este caso, el valor de la secuencia se genera siempre, genrando un error si se intenta insertar un valor en la columna. 


## Llaves primarias compuestas

Se pueden crear llaves primarias compuestas, es decir, que una llave primaria este compuesta por dos o mas columnas. Las columnas que forman la llave primaria no pueden tener valores nulos. Las columnas no necesariamente deben ser unicas, pero la combinacion de las columnas debe ser unica.
    
```sql
CREATE TABLE "usersDual"(
    id1 INT,
    id2 INT,
    "username" VARCHAR(50) NOT NULL,
    PRIMARY KEY(id1, id2)
)
```

## UUID

Se pueden utilizar UUID como llaves primarias. Para ello se debe instalar la extension `uuid-ossp` y luego se puede utilizar la funcion `uuid_generate_v4()` para generar un UUID.

> Nota: para instalar la extension se debe ejecutar el siguiente comando: `CREATE EXTENSION IF NOT EXISTS "uuid-ossp";`
        
```sql
CREATE TABLE "usersUUID"(
    "user_id" UUID DEFAULT uuid_generate_v4(),
    "username" VARCHAR(50) NOT NULL,
    PRIMARY KEY("user_id")
)
```

## Secuencias

Para consultar las secuencias se puede utilizar la siguiente consulta:
```sql
SELECT * FROM information_schema.sequences;
```

>Nota: por defecto las secuencias se crean con un valor inicial de 1 y un incremento de 1.
```sql
CREATE SEQUENCE "user_id_seq";
DROP SEQUENCE "user_id_seq"; -- Elimina la secuencia
```

- Obtener el siguiente valor de la secuencia y el valor actual
```sql
SELECT nextval('user_id_seq'), currval('user_id_seq');
```
> Nota: al consultar el `nextval` este valor se reserva y no puede ser usado despues.

- Reiniciar la secuencia
```sql
ALTER SEQUENCE "user_id_seq" RESTART WITH 1;
```

- Usar la secuencia en una tabla
```sql
CREATE TABLE "usersSeq"(
    "user_id" INT DEFAULT nextval('user_id_seq'),
    "username" VARCHAR(50) NOT NULL,
    PRIMARY KEY("user_id")
)
```